<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>üí∞ Meu Gestor Financeiro Pro</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' }</script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --main-green: #4CAF50;
      --accent-yellow: #FFC107;
      --accent-red: #F44336;
      --accent-blue: #2196F3;
      --purple: #9C27B0;
    }

    body { 
      -webkit-font-smoothing: antialiased; 
      font-family: 'Segoe UI', system-ui, sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }

    body.dark {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #e0e0e0;
    }
    
    body.dark .app-frame {
      background: rgba(30, 30, 46, 0.95);
      color: #e0e0e0;
    }

    body.dark .chart-card,
    body.dark .bg-white {
      background: #2a2a3e !important;
      color: #e0e0e0;
    }

    body.dark .keypad-btn {
      background: #3a3a4e;
      color: #e0e0e0;
      border-color: #4a4a5e;
    }

    #root {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .app-frame {
      width: 100%;
      max-width: 420px;
      height: 90vh;
      max-height: 900px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
      border-radius: 24px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s;
    }
    
    @media (min-width: 768px) {
      .app-frame {
        max-width: 1200px;
        max-height: 700px;
        flex-direction: row;
      }
    }
    
    .main-header {
      background: linear-gradient(135deg, var(--main-green) 0%, #388E3C 100%);
      color: white;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .tab-active {
      border-bottom: 3px solid white;
      padding-bottom: 2px;
    }
    
    .fab {
      background: linear-gradient(135deg, var(--accent-yellow) 0%, #FFA000 100%);
      box-shadow: 0 6px 16px rgba(255, 193, 7, 0.4);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .fab:hover {
      transform: translateY(-2px) scale(1.05);
    }
    
    .fab:active {
      transform: translateY(0) scale(0.95);
    }
    
    .chart-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }
    
    .keypad-btn {
      background: #F5F5F5;
      border-radius: 12px;
      color: #424242;
      font-size: 1.5rem;
      font-weight: 500;
      transition: all 0.1s ease;
      border: 1px solid #E0E0E0;
    }
    
    .keypad-btn:active {
      background: #E0E0E0;
      transform: scale(0.95);
    }
    
    .keypad-ok {
      background: linear-gradient(135deg, var(--main-green) 0%, #388E3C 100%);
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
    }
    
    .category-chip {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .category-chip:hover {
      transform: translateY(-2px);
    }
    
    .category-chip.selected {
      box-shadow: 0 0 0 2px var(--main-green), 0 4px 12px rgba(76, 175, 80, 0.2);
    }

    .transaction-item {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .income-color { color: var(--main-green); }
    .expense-color { color: var(--accent-red); }

    /* MENU LATERAL */
    .side-menu {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100vh;
      background: white;
      box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
      transition: left 0.3s ease;
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
    }

    .side-menu.open {
      left: 0;
    }

    body.dark .side-menu {
      background: #2a2a3e;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .menu-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .menu-item {
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .menu-item:hover {
      background: rgba(76, 175, 80, 0.1);
    }

    .menu-item.active {
      background: var(--main-green);
      color: white;
    }

    @media (min-width: 768px) {
      .side-menu {
        position: relative;
        left: 0;
        height: auto;
        box-shadow: none;
        width: 250px;
      }
      .menu-overlay, .menu-toggle {
        display: none;
      }
    }

    /* FOOTER */
    .app-footer {
      padding: 16px;
      text-align: center;
      font-size: 12px;
      color: #9e9e9e;
      border-top: 1px solid #e0e0e0;
    }

    body.dark .app-footer {
      border-color: #4a4a5e;
    }

    /* MODAL */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s;
    }

    .modal-overlay.open .modal-content {
      transform: scale(1);
    }

    body.dark .modal-content {
      background: #2a2a3e;
    }

    /* TOGGLE SWITCH */
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--main-green);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    /* FINANCIAL TIPS */
    .tip-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }

    /* BACKUP BUTTONS */
    .backup-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      transition: all 0.3s;
    }

    .backup-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
  </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

/* ---------------- CONFIG ---------------- */
const PROFILE_KEY = "meu_gestor_profile_v1";
const TX_KEY = "meu_gestor_transactions_v1";
const THEME_KEY = "meu_gestor_theme_v1";

/* ---------------- ICONS ---------------- */
function IconHeart(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>); }
function IconLazer() { return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>); }
function IconCasa(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>); }
function IconCafe(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>); }
function IconMarket(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 3v12M12 3v12M18 3v12"/><path d="M4 18h16a2 2 0 0 1 2 2v2H2v-2a2 2 0 0 1 2-2z"/></svg>);}
function IconEducation(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2l10 5.5v11L12 22 2 17.5V6.5L12 2zM12 22v-9M22 8l-10 5.5L2 8"/></svg>);}
function IconOthers(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>);}

/* NOVOS √çCONES */
function IconCollege(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h20v14H2zM4 3v18M20 21v-3a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v3"/></svg>); }
function IconLight(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41M12 6a6 6 0 1 0 0 12 6 6 0 0 0 0-12z"/></svg>); }
function IconWater(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>); }
function IconInternet(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="2"/><path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"/></svg>); }
function IconSalary(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>); }
function IconCreditCard(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>); }

function IconMenu(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>);}
function IconClose(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>);}
function IconDashboard(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>);}
function IconTransactions(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>);}
function IconSettings(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m4.22-10.22l1.42 1.42M6.36 17.64l1.42 1.42M1 12h6m6 0h6m-10.22 4.22l1.42-1.42M17.64 6.36l1.42-1.42"/></svg>);}
function IconUser(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>);}
function IconEdit(){ return (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>);}
function IconTips(){ return (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><circle cx="12" cy="12" r="10"/><line x1="12" y1="17" x2="12" y2="17"/></svg>);}
function IconDownload(){ return (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>);}
function IconUpload(){ return (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>);}

const CATEGORIES = [
  { id: 'saude', name: 'Sa√∫de', color: '#F44336', icon: IconHeart },
  { id: 'lazer', name: 'Lazer', color: '#FFC107', icon: IconLazer },
  { id: 'moradia', name: 'Casa', color: '#2196F3', icon: IconCasa },
  { id: 'alimentacao', name: 'Caf√©', color: '#009688', icon: IconCafe },
  { id: 'compras', name: 'Compras', color: '#4CAF50', icon: IconMarket },
  { id: 'educacao', name: 'Educa√ß√£o', color: '#9C27B0', icon: IconEducation },
  { id: 'outros', name: 'Outros', color: '#9E9E9E', icon: IconOthers },
  { id: 'faculdade', name: 'Faculdade', color: '#FF5722', icon: IconCollege },
  { id: 'luz', name: 'Luz', color: '#FFEB3B', icon: IconLight },
  { id: 'agua', name: '√Ågua', color: '#03A9F4', icon: IconWater },
  { id: 'internet', name: 'Internet', color: '#673AB7', icon: IconInternet },
  { id: 'salario', name: 'Sal√°rio', color: '#4CAF50', icon: IconSalary },
  { id: 'cartoes', name: 'Cart√µes', color: '#E91E63', icon: IconCreditCard },
];

/* ---------------- HELPERS ---------------- */
function genId(){ return 'id-' + Date.now().toString(36) + '-' + Math.random().toString(36).slice(2, 8); }
function formatBRL(amount){ return `R$ ${Number(amount).toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, '.')}`; }
function formatDate(dateStr){ 
  const [year, month, day] = dateStr.split('-');
  return `${day}/${month}/${year}`;
}

function loadData(key, defaultValue = null){
  try {
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : defaultValue;
  } catch(e) { return defaultValue; }
}

function saveData(key, data){
  try { localStorage.setItem(key, JSON.stringify(data)); } catch(e) { console.error(e); }
}

/* COPIAR DESPESAS FIXAS */
function copyFixedExpenses(currentTransactions, currentMonth){
  const nextMonth = new Date(currentMonth + '-01');
  nextMonth.setMonth(nextMonth.getMonth() + 1);
  const nextMonthKey = nextMonth.toISOString().slice(0, 7);
  
  const existingNextMonth = currentTransactions.filter(t => 
    t.date.slice(0, 7) === nextMonthKey && t.fixed
  );
  
  if(existingNextMonth.length > 0) return currentTransactions;
  
  const fixedExpenses = currentTransactions.filter(t => 
    (t.type === 'expense' || t.type === 'income') && t.fixed && t.date.slice(0, 7) === currentMonth
  );
  
  const newTransactions = [...currentTransactions];
  
  fixedExpenses.forEach(expense => {
    const newExpense = {
      ...expense,
      id: genId(),
      date: nextMonthKey + '-01'
    };
    newTransactions.push(newExpense);
  });
  
  return newTransactions;
}

/* ---------------- SALDO NO GR√ÅFICO ---------------- */
function Donut({ items, darkMode, totalIncome, totalExpenses }){
  const canvasRef = useRef(null);
  const balance = totalIncome - totalExpenses;
  
  useEffect(() => {
    if(!canvasRef.current) return;
    
    const chartData = items.map(i => i.value);
    const chartLabels = items.map(i => i.name);
    const chartColors = items.map(i => CATEGORIES.find(c => c.name === i.name)?.color || '#9E9E9E');

    const centerTextPlugin = {
      id: 'centerText',
      beforeDraw(chart){
        const { ctx, width, height } = chart;
        ctx.save();
        
        // Mostra SALDO no centro
        const value = balance >= 0 ? formatBRL(balance) : `-${formatBRL(Math.abs(balance))}`;
        ctx.font = `600 ${Math.round(Math.min(width, height) / 10)}px sans-serif`;
        ctx.fillStyle = darkMode ? '#e0e0e0' : '#424242';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(value, width / 2, height / 2);
        
        // Subt√≠tulo "SALDO"
        ctx.font = `500 ${Math.round(Math.min(width, height) / 20)}px sans-serif`;
        ctx.fillStyle = darkMode ? '#a0a0a0' : '#666';
        ctx.fillText('SALDO', width / 2, height / 2 - 30);
        ctx.restore();
      }
    };

    const old = Chart.getChart(canvasRef.current);
    if(old) old.destroy();
    
    const ch = new Chart(canvasRef.current, {
      type: 'doughnut',
      data: { 
        labels: chartLabels, 
        datasets: [{ 
          data: chartData, 
          backgroundColor: chartColors, 
          borderColor: darkMode ? '#2a2a3e' : 'white', 
          borderWidth: 3 
        }] 
      },
      options: {
        cutout: '70%',
        plugins: { 
          legend: { display: false },
          tooltip: {
            backgroundColor: darkMode ? '#2a2a3e' : 'rgba(0,0,0,0.8)',
            titleColor: darkMode ? '#e0e0e0' : 'white',
            bodyColor: darkMode ? '#e0e0e0' : 'white',
            padding: 12,
            cornerRadius: 8,
            callbacks: {
              label: function(context) {
                const label = context.label || '';
                const value = formatBRL(context.parsed);
                const percentage = totalExpenses > 0 ? ((context.parsed / totalExpenses) * 100).toFixed(1) : 0;
                return `${label}: ${value} (${percentage}%)`;
              }
            }
          }
        },
        animation: { animateScale: true, duration: 800 },
        responsive: true,
        maintainAspectRatio: false,
      },
      plugins: [centerTextPlugin]
    });
    
    return () => ch.destroy();
  }, [canvasRef, items, balance, darkMode]);
  
  return (
    <div className="relative h-56 w-full max-w-xs mx-auto my-4">
      <canvas ref={canvasRef} />
    </div>
  );
}

/* ---------------- PROFILE SCREEN ---------------- */
function ProfileScreen({ onComplete }){
  const [name, setName] = useState('');
  const [birthDate, setBirthDate] = useState('');

  function handleSubmit(){
    if(!name.trim() || !birthDate){
      alert('‚ö†Ô∏è Preencha todos os campos.');
      return;
    }
    
    saveData(PROFILE_KEY, { name, birthDate });
    onComplete();
  }

  return (
    <div className="flex flex-col items-center justify-center h-full p-6 bg-gradient-to-br from-green-100 to-green-200">
      <div className="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm">
        <h2 className="text-2xl font-bold text-center mb-6 text-gray-800">üéØ Bem-vindo ao Meu Gestor!</h2>
        <p className="text-center text-gray-600 mb-6">Preencha seus dados para come√ßar</p>
        
        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="Seu nome"
              className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
              autoFocus
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Data de Nascimento</label>
            <input
              type="date"
              value={birthDate}
              onChange={(e) => setBirthDate(e.target.value)}
              className="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
            />
          </div>
          
          <button 
            onClick={handleSubmit}
            className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition"
          >
            ‚úì COME√áAR AGORA
          </button>
        </div>
      </div>
    </div>
  );
}

/* ---------------- MENU LATERAL ---------------- */
function SideMenu({ isOpen, onClose, currentScreen, setCurrentScreen, darkMode, toggleTheme, profile }){
  const menuItems = [
    { id: 'dashboard', label: 'Dashboard', icon: IconDashboard },
    { id: 'transactions', label: 'Lan√ßamentos', icon: IconTransactions },
    { id: 'tips', label: 'Dicas Financeiras', icon: IconTips },
    { id: 'profile', label: 'Meu Perfil', icon: IconUser },
    { id: 'settings', label: 'Configura√ß√µes', icon: IconSettings },
  ];

  return (
    <>
      <div className={`menu-overlay ${isOpen ? 'open' : ''}`} onClick={onClose}></div>
      <div className={`side-menu ${isOpen ? 'open' : ''}`}>
        <div className="flex items-center justify-between mb-6 pb-4 border-b border-gray-200 dark:border-gray-700">
          <h2 className="text-xl font-bold text-gray-800 dark:text-gray-200">Menu</h2>
          <button onClick={onClose} className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
            <IconClose />
          </button>
        </div>
        
        <div className="mb-6 p-4 bg-green-50 dark:bg-green-900 rounded-lg">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-lg">
              {profile?.name?.charAt(0).toUpperCase() || 'U'}
            </div>
            <div>
              <div className="font-semibold text-gray-800 dark:text-gray-200">{profile?.name || 'Usu√°rio'}</div>
              <div className="text-xs text-gray-500 dark:text-gray-400">
                {profile?.birthDate ? formatDate(profile.birthDate) : 'N√£o informado'}
              </div>
            </div>
          </div>
        </div>

        <nav>
          {menuItems.map(item => (
            <div 
              key={item.id}
              className={`menu-item ${currentScreen === item.id ? 'active' : ''}`}
              onClick={() => {
                setCurrentScreen(item.id);
                onClose();
              }}
            >
              <item.icon />
              <span className="font-medium">{item.label}</span>
            </div>
          ))}
        </nav>

        <div className="mt-8 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
          <div className="flex items-center justify-between mb-2">
            <span className="font-medium text-gray-800 dark:text-gray-200">Tema Escuro</span>
            <label className="switch">
              <input 
                type="checkbox" 
                checked={darkMode}
                onChange={toggleTheme}
              />
              <span className="slider"></span>
            </label>
          </div>
        </div>
      </div>
    </>
  );
}

/* ---------------- TELA DE DICAS ---------------- */
function TipsScreen(){
  const tips = [
    { id: 1, title: "üìä Fa√ßa um or√ßamento mensal", content: "Registre todas as suas receitas e despesas para ter controle total do seu dinheiro." },
    { id: 2, title: "üí∞ Economize 10% da renda", content: "Tente guardar pelo menos 10% de tudo que ganhar. Isso cria um fundo de emerg√™ncia." },
    { id: 3, title: "üéØ Defina metas financeiras", content: "Tenha objetivos claros: curto prazo (1 ano), m√©dio prazo (5 anos) e longo prazo (10+ anos)." },
    { id: 4, title: "üí≥ Evite d√≠vidas de cart√£o", content: "Pague a fatura total do cart√£o todos os meses para n√£o pagar juros altos." },
    { id: 5, title: "üìà Invista seu dinheiro", content: "Comece cedo! Mesmo pequenos valores investidos rendem muito no longo prazo." },
    { id: 6, title: "üõí Fa√ßa listas de compras", content: "Evite compras por impulso. Planeje o que vai comprar antes de sair de casa." },
    { id: 7, title: "üîÑ Revis√£o mensal", content: "Todo m√™s, analise seus gastos e veja onde pode economizar mais." },
    { id: 8, title: "üì± Use apps de controle", content: "Ferramentas como este ajudam a manter o h√°bito de controlar suas finan√ßas." },
  ];

  return (
    <div className="flex flex-col h-full bg-gray-50 dark:bg-gray-900">
      <div className="main-header">
        <h2 className="text-xl font-bold">üí° Dicas Financeiras</h2>
      </div>
      <div className="flex-1 p-4 overflow-y-auto">
        <div className="space-y-4">
          {tips.map(tip => (
            <div key={tip.id} className="tip-card">
              <h3 className="font-bold text-lg mb-2">{tip.title}</h3>
              <p className="text-sm opacity-90">{tip.content}</p>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

/* ---------------- DASHBOARD SCREEN ---------------- */
function DashboardScreen({ 
  expensesByCategory, 
  allTransactions, 
  onAddClick, 
  onDeleteTransaction,
  onEditTransaction,
  selectedMonth, 
  setSelectedMonth,
  darkMode 
}){
  const [activeTab, setActiveTab] = useState('Semana');
  
  const totalExpenses = useMemo(() => 
    expensesByCategory.reduce((sum, item) => sum + item.value, 0), 
  [expensesByCategory]);
  
  const totalIncome = useMemo(() => 
    allTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0), 
  [allTransactions]);
  
  const balance = totalIncome - totalExpenses;
  
  // Meses para o filtro
  const months = useMemo(() => {
    const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
    const currentMonth = new Date().getMonth();
    const currentYear = new Date().getFullYear();
    return Array.from({length: 12}, (_, i) => {
      const month = (currentMonth - i + 12) % 12;
      const year = currentYear - Math.floor((currentMonth - i) / 12);
      return { value: `${year}-${String(month + 1).padStart(2, '0')}`, label: `${monthNames[month]} ${year}` };
    });
  }, []);

  const dateRange = "18 fev ‚Äì 24 fev";

  return (
    <div className="flex flex-col h-full bg-gray-50 dark:bg-gray-900">
      {/* HEADER */}
      <div className="main-header flex flex-col items-center">
        <div className="flex justify-between w-full mb-2 items-center">
          <span className="text-white/80 text-sm font-medium">Saldo Atual</span>
          <button className="p-2 rounded-full hover:bg-white/20 transition">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <path d="M16 8l-6 6-4-4"/>
            </svg>
          </button>
        </div>
        
        {/* RESUMO FINANCEIRO */}
        <div className="w-full grid grid-cols-3 gap-2 text-center mb-3">
          <div>
            <div className="text-xs opacity-80">Receitas</div>
            <div className="text-lg font-bold income-color">{formatBRL(totalIncome)}</div>
          </div>
          <div>
            <div className="text-xs opacity-80">Despesas</div>
            <div className="text-lg font-bold expense-color">{formatBRL(totalExpenses)}</div>
          </div>
          <div>
            <div className="text-xs opacity-80">Saldo</div>
            <div className={`text-lg font-bold ${balance >= 0 ? 'text-white' : 'text-yellow-300'}`}>
              {formatBRL(balance)}
            </div>
          </div>
        </div>
      </div>
      
      {/* MONTH FILTER */}
      <div className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-2">
        <select 
          value={selectedMonth} 
          onChange={(e) => setSelectedMonth(e.target.value)}
          className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white"
        >
          {months.map(m => (
            <option key={m.value} value={m.value}>{m.label}</option>
          ))}
        </select>
      </div>
      
      {/* CONTENT */}
      <div className="flex-1 p-4 overflow-y-auto">
        <div className="chart-card p-5 mb-4 dark:bg-gray-800">
          {/* TABS */}
          <div className="flex justify-between text-gray-500 text-sm font-medium border-b border-gray-100 dark:border-gray-700 pb-3 mb-4">
            {['Dia', 'Semana', 'M√™s', 'Ano', 'Per√≠odo'].map(tab => (
              <button 
                key={tab} 
                onClick={() => setActiveTab(tab)} 
                className={`px-3 py-1 rounded-lg transition font-medium ${
                  activeTab === tab ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300' : 'hover:bg-gray-100 dark:hover:bg-gray-700'
                }`}
              >
                {tab}
              </button>
            ))}
          </div>

          {/* DATE NAVIGATOR */}
          <div className="flex items-center justify-between mb-4 px-2">
            <button className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <span className="font-semibold text-sm text-gray-700 dark:text-gray-300">{dateRange}</span>
            <button className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>

          {/* CHART - COM SALDO NO CENTRO */}
          <Donut 
            items={expensesByCategory} 
            darkMode={darkMode} 
            totalIncome={allTransactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0)}
            totalExpenses={expensesByCategory.reduce((s, i) => s + i.value, 0)}
          />
          
          {/* ADD BUTTON */}
          <div className="flex justify-end -mt-12 mb-2">
            <button 
              onClick={() => onAddClick('expense')} 
              className="fab w-14 h-14 rounded-full flex items-center justify-center text-3xl font-light"
            >
              +
            </button>
          </div>
        </div>

        {/* RECENT TRANSACTIONS */}
        <div className="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-lg mb-16">
          <h3 className="font-bold text-lg text-gray-800 dark:text-gray-200 mb-3">√öltimas Transa√ß√µes</h3>
          <div className="space-y-2 max-h-60 overflow-y-auto">
            {allTransactions
              .slice(0, 5)
              .map(tx => {
                const cat = CATEGORIES.find(c => c.id === tx.category);
                const isIncome = tx.type === 'income';
                
                return (
                  <div key={tx.id} className="transaction-item flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                    <div className="flex items-center gap-3">
                      <div 
                        className="w-10 h-10 rounded-full flex items-center justify-center text-white shadow-sm" 
                        style={{ backgroundColor: cat?.color || '#9E9E9E' }}
                      >
                        {cat && React.createElement(cat.icon, { width: "18", height: "18", strokeWidth: "3" })}
                      </div>
                      <div>
                        <div className="font-semibold text-sm text-gray-800 dark:text-gray-200">
                          {tx.description || cat?.name || 'Outros'}
                        </div>
                        <div className="text-xs text-gray-500 dark:text-gray-400">{formatDate(tx.date)}</div>
                      </div>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className={`font-bold text-lg ${isIncome ? 'income-color' : 'expense-color'}`}>
                        {isIncome ? '+' : '-'}{formatBRL(tx.amount)}
                      </div>
                      {tx.fixed && <span className="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full">Fixa</span>}
                      <button 
                        onClick={() => onEditTransaction(tx)}
                        className="p-1 text-blue-500 hover:bg-blue-100 rounded-full transition"
                      >
                        <IconEdit />
                      </button>
                      <button 
                        onClick={() => {
                          if(confirm('‚ùå Tem certeza que deseja excluir esta transa√ß√£o?')){
                            onDeleteTransaction(tx.id);
                          }
                        }}
                        className="p-1 text-red-500 hover:bg-red-100 rounded-full transition"
                      >
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <polyline points="3 6 5 6 21 6"></polyline>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                );
              })}
            {allTransactions.length === 0 && (
              <div className="text-center text-gray-500 dark:text-gray-400 text-sm py-4">
                <div className="mb-2 text-2xl">üìä</div>
                Nenhuma transa√ß√£o neste per√≠odo
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

/* ---------------- TRANSACTIONS SCREEN ---------------- */
function TransactionsScreen({ 
  transactions, 
  onDeleteTransaction, 
  onEditTransaction,
  selectedMonth, 
  setSelectedMonth 
}){
  const [filterType, setFilterType] = useState('all');
  
  const filteredTransactions = useMemo(() => {
    let filtered = transactions.filter(t => t.date.slice(0, 7) === selectedMonth);
    if(filterType !== 'all'){
      filtered = filtered.filter(t => t.type === filterType);
    }
    return filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
  }, [transactions, selectedMonth, filterType]);

  const months = useMemo(() => {
    const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
    const currentMonth = new Date().getMonth();
    const currentYear = new Date().getFullYear();
    return Array.from({length: 12}, (_, i) => {
      const month = (currentMonth - i + 12) % 12;
      const year = currentYear - Math.floor((currentMonth - i) / 12);
      return { value: `${year}-${String(month + 1).padStart(2, '0')}`, label: `${monthNames[month]} ${year}` };
    });
  }, []);

  return (
    <div className="flex flex-col h-full bg-gray-50 dark:bg-gray-900">
      <div className="main-header">
        <h2 className="text-xl font-bold">Lan√ßamentos</h2>
      </div>
      
      {/* FILTERS */}
      <div className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3">
        <div className="flex gap-2 mb-3">
          <button 
            onClick={() => setFilterType('all')}
            className={`px-3 py-1 rounded-full text-sm font-medium transition ${
              filterType === 'all' ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300' : 'hover:bg-gray-100 dark:hover:bg-gray-700'
            }`}
          >
            Todos
          </button>
          <button 
            onClick={() => setFilterType('income')}
            className={`px-3 py-1 rounded-full text-sm font-medium transition ${
              filterType === 'income' ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300' : 'hover:bg-gray-100 dark:hover:bg-gray-700'
            }`}
          >
            Receitas
          </button>
          <button 
            onClick={() => setFilterType('expense')}
            className={`px-3 py-1 rounded-full text-sm font-medium transition ${
              filterType === 'expense' ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300' : 'hover:bg-gray-100 dark:hover:bg-gray-700'
            }`}
          >
            Despesas
          </button>
        </div>
        
        <select 
          value={selectedMonth} 
          onChange={(e) => setSelectedMonth(e.target.value)}
          className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white"
        >
          {months.map(m => (
            <option key={m.value} value={m.value}>{m.label}</option>
          ))}
        </select>
      </div>
      
      {/* LIST */}
      <div className="flex-1 p-4 overflow-y-auto pb-20">
        <div className="space-y-3">
          {filteredTransactions.map(tx => {
            const cat = CATEGORIES.find(c => c.id === tx.category);
            const isIncome = tx.type === 'income';
            
            return (
              <div key={tx.id} className="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3 flex-1">
                    <div 
                      className="w-12 h-12 rounded-full flex items-center justify-center text-white shadow-md" 
                      style={{ backgroundColor: cat?.color || '#9E9E9E' }}
                    >
                      {cat && React.createElement(cat.icon, { width: "20", height: "20", strokeWidth: "2.5" })}
                    </div>
                    <div className="flex-1">
                      <div className="font-semibold text-gray-800 dark:text-gray-200">{tx.description}</div>
                      <div className="text-sm text-gray-500 dark:text-gray-400">{cat?.name} ‚Ä¢ {formatDate(tx.date)}</div>
                    </div>
                  </div>
                  <div className="text-right">
                    <div className={`font-bold text-xl ${isIncome ? 'income-color' : 'expense-color'}`}>
                      {isIncome ? '+' : '-'}{formatBRL(tx.amount)}
                    </div>
                    <div className="flex gap-1 mt-1 justify-end">
                      <button 
                        onClick={() => onEditTransaction(tx)}
                        className="p-2 text-blue-500 hover:bg-blue-100 dark:hover:bg-blue-900 rounded-full transition"
                      >
                        <IconEdit />
                      </button>
                      <button 
                        onClick={() => {
                          if(confirm('‚ùå Tem certeza que deseja excluir esta transa√ß√£o?')){
                            onDeleteTransaction(tx.id);
                          }
                        }}
                        className="p-2 text-red-500 hover:bg-red-100 dark:hover:bg-red-900 rounded-full transition"
                      >
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <polyline points="3 6 5 6 21 6"></polyline>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
                {tx.fixed && (
                  <div className="mt-2 text-xs bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-300 px-3 py-1 rounded-full inline-block">
                    Fixa (Repete todo m√™s)
                  </div>
                )}
              </div>
            );
          })}
          {filteredTransactions.length === 0 && (
            <div className="text-center text-gray-500 dark:text-gray-400 text-sm py-8">
              <div className="mb-2 text-2xl">üìä</div>
              Nenhuma transa√ß√£o encontrada
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

/* ---------------- ADD/EDIT TRANSACTION FORM ---------------- */
function TransactionForm({ 
  onSave, 
  onCancel, 
  editing = null,
  initialType = 'expense'
}){
  const [type, setType] = useState(editing?.type || initialType);
  const [amount, setAmount] = useState(editing?.amount.toString() || '');
  const [selectedCategory, setSelectedCategory] = useState(editing?.category || CATEGORIES[0].id);
  const [description, setDescription] = useState(editing?.description || '');
  const [isFixed, setIsFixed] = useState(editing?.fixed || false);
  const [date, setDate] = useState(editing?.date || new Date().toISOString().slice(0, 10));

  function handleSubmit(){
    const numAmount = parseFloat(amount);
    if(isNaN(numAmount) || numAmount <= 0) {
      alert('‚ö†Ô∏è Digite um valor v√°lido.');
      return;
    }
    
    if(!description.trim()){
      alert('‚ö†Ô∏è Adicione uma descri√ß√£o.');
      return;
    }
    
    const tx = {
      id: editing?.id || genId(),
      type: type,
      category: selectedCategory,
      amount: numAmount,
      date: date,
      description: description.trim(),
      fixed: isFixed
    };
    
    onSave(tx);
  }

  return (
    <div className="modal-overlay open">
      <div className="modal-content">
        <h2 className="text-xl font-bold mb-4 text-gray-800 dark:text-gray-200">
          {editing ? '‚úèÔ∏è Editar' : '‚ûï Adicionar'} {type === 'income' ? 'Receita' : 'Despesa'}
        </h2>
        
        {/* TYPE TOGGLE */}
        <div className="flex gap-2 mb-4">
          <button 
            onClick={() => setType('expense')}
            className={`flex-1 p-2 rounded-lg font-medium transition ${
              type === 'expense' ? 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300' : 'bg-gray-100 dark:bg-gray-700'
            }`}
          >
            Despesa
          </button>
          <button 
            onClick={() => setType('income')}
            className={`flex-1 p-2 rounded-lg font-medium transition ${
              type === 'income' ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300' : 'bg-gray-100 dark:bg-gray-700'
            }`}
          >
            Receita
          </button>
        </div>

        {/* AMOUNT */}
        <div className="mb-4">
          <label className="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Valor (R$)</label>
          <input
            type="number"
            value={amount}
            onChange={(e) => setAmount(e.target.value)}
            placeholder="0,00"
            step="0.01"
            className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white"
            autoFocus
          />
        </div>

        {/* DESCRIPTION */}
        <div className="mb-4">
          <label className="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Descri√ß√£o</label>
          <input
            type="text"
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            placeholder="Ex: Sal√°rio, Mercado, Cinema..."
            className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white"
          />
        </div>

        {/* DATE */}
        <div className="mb-4">
          <label className="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Data</label>
          <input
            type="date"
            value={date}
            onChange={(e) => setDate(e.target.value)}
            className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-700 dark:text-white"
          />
        </div>

        {/* CATEGORIES */}
        <div className="mb-4">
          <label className="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Categoria</label>
          <div className="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto">
            {CATEGORIES.map(c => (
              <button 
                key={c.id} 
                onClick={() => setSelectedCategory(c.id)} 
                className={`category-chip flex items-center gap-2 p-2 rounded-lg transition border ${
                  selectedCategory === c.id ? 'selected border-green-500' : 'border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700'
                }`}
              >
                <div className="w-8 h-8 rounded-full flex items-center justify-center text-white" style={{ backgroundColor: c.color }}>
                  {React.createElement(c.icon, { width: "16", height: "16", strokeWidth: "3" })}
                </div>
                <span className="text-sm font-medium text-gray-700 dark:text-gray-300">{c.name}</span>
              </button>
            ))}
          </div>
        </div>

        {/* FIXED TOGGLE - TEXTO ATUALIZADO */}
        <div className="mb-6">
          <label className="flex items-center gap-3 cursor-pointer">
            <input
              type="checkbox"
              checked={isFixed}
              onChange={(e) => setIsFixed(e.target.checked)}
              className="w-5 h-5"
            />
            <span className="font-medium text-gray-700 dark:text-gray-300">Receita ou Despesa fixa</span>
          </label>
        </div>

        {/* BUTTONS */}
        <div className="flex gap-2">
          <button 
            onClick={onCancel}
            className="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-lg transition"
          >
            Cancelar
          </button>
          <button 
            onClick={handleSubmit}
            className="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition"
          >
            {editing ? 'Salvar' : 'Adicionar'}
          </button>
        </div>
      </div>
    </div>
  );
}

/* ---------------- SETTINGS SCREEN ---------------- */
function SettingsScreen({ darkMode, toggleTheme, profile }){
  const [backupStatus, setBackupStatus] = useState('');

  function exportData(){
    const data = {
      profile: loadData(PROFILE_KEY),
      transactions: loadData(TX_KEY, []),
      theme: loadData(THEME_KEY),
      exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `backup-financeiro-${new Date().toISOString().slice(0, 10)}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    setBackupStatus('‚úÖ Backup realizado com sucesso!');
    setTimeout(() => setBackupStatus(''), 3000);
  }

  function importData(event){
    const file = event.target.files[0];
    if(!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        
        if(data.profile) saveData(PROFILE_KEY, data.profile);
        if(data.transactions) saveData(TX_KEY, data.transactions);
        if(data.theme !== undefined) saveData(THEME_KEY, data.theme);
        
        setBackupStatus('‚úÖ Dados importados com sucesso! Recarregando...');
        setTimeout(() => window.location.reload(), 2000);
      } catch(err) {
        alert('‚ùå Erro ao importar dados. Verifique o arquivo.');
      }
    };
    reader.readAsText(file);
  }

  return (
    <div className="flex flex-col h-full bg-gray-50 dark:bg-gray-900">
      <div className="main-header">
        <h2 className="text-xl font-bold">Configura√ß√µes</h2>
      </div>
      <div className="flex-1 p-4 overflow-y-auto pb-20">
        <div className="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-lg space-y-5">
          {/* TEMA */}
          <div className="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <span className="font-medium text-gray-800 dark:text-gray-200">üåô Tema Escuro</span>
            <label className="switch">
              <input 
                type="checkbox" 
                checked={darkMode}
                onChange={toggleTheme}
              />
              <span className="slider"></span>
            </label>
          </div>

          {/* DADOS DO USU√ÅRIO */}
          <div className="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <div className="font-medium mb-2 text-gray-800 dark:text-gray-200">üë§ Informa√ß√µes do Usu√°rio</div>
            <div className="text-sm text-gray-600 dark:text-gray-400 space-y-1">
              <div>Nome: <strong>{profile?.name || 'N√£o informado'}</strong></div>
              <div>Nascimento: <strong>{profile?.birthDate ? formatDate(profile.birthDate) : 'N√£o informado'}</strong></div>
            </div>
          </div>

          {/* BACKUP */}
          <div className="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <div className="font-medium mb-3 text-gray-800 dark:text-gray-200">üíæ Backup de Dados</div>
            
            {backupStatus && (
              <div className="mb-3 p-2 bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 rounded-lg text-sm text-center">
                {backupStatus}
              </div>
            )}
            
            <div className="flex flex-col gap-2">
              <button 
                onClick={exportData}
                className="backup-btn w-full flex items-center justify-center gap-2"
              >
                <IconDownload /> Exportar Dados
              </button>
              
              <label className="backup-btn w-full text-center cursor-pointer flex items-center justify-center gap-2">
                <IconUpload /> Importar Dados
                <input type="file" accept=".json" onChange={importData} className="hidden" />
              </label>
            </div>
            
            <div className="mt-3 text-xs text-gray-500 dark:text-gray-400">
              Os dados s√£o salvos automaticamente no navegador. Use Exportar/Importar para fazer backup externo.
            </div>
          </div>

          {/* LIMPAR DADOS */}
          <div className="p-3 bg-red-50 dark:bg-red-900 rounded-lg">
            <div className="font-medium mb-2 text-red-700 dark:text-red-300">üóëÔ∏è Zona de Perigo</div>
            <button 
              onClick={() => {
                if(confirm('‚ö†Ô∏è ATEN√á√ÉO! Isso apagar√° TODOS os seus dados permanentemente. Tem certeza?')){
                  localStorage.clear();
                  window.location.reload();
                }
              }}
              className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition w-full"
            >
              Limpar Todos os Dados
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

/* ---------------- MAIN APP ---------------- */
function App(){
  const [screen, setScreen] = useState('profile'); // profile, dashboard, transactions, tips, settings
  const [transactions, setTransactions] = useState(() => loadData(TX_KEY, []));
  const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));
  const [darkMode, setDarkMode] = useState(() => loadData(THEME_KEY, false));
  const [menuOpen, setMenuOpen] = useState(false);
  const [showForm, setShowForm] = useState(false);
  const [editingTransaction, setEditingTransaction] = useState(null);
  const [profile, setProfile] = useState(() => loadData(PROFILE_KEY, null));

  // Salvar automaticamente quando dados mudam
  useEffect(() => {
    saveData(TX_KEY, transactions);
    saveData(THEME_KEY, darkMode);
    
    // Aplicar tema no body
    if(darkMode) {
      document.body.classList.add('dark');
    } else {
      document.body.classList.remove('dark');
    }
  }, [transactions, darkMode]);

  // Copiar transa√ß√µes fixas ao mudar de m√™s
  useEffect(() => {
    if(selectedMonth) {
      const updatedTransactions = copyFixedExpenses(transactions, selectedMonth);
      if(updatedTransactions.length > transactions.length) {
        setTransactions(updatedTransactions);
      }
    }
  }, [selectedMonth]);

  if(!profile && screen !== 'profile') {
    setScreen('profile');
    return null;
  }

  // Filtra transa√ß√µes pelo m√™s selecionado
  const filteredTransactions = useMemo(() => {
    return transactions.filter(t => t.date.slice(0, 7) === selectedMonth);
  }, [transactions, selectedMonth]);

  // Despesas por categoria (para o gr√°fico)
  const expensesByCategory = useMemo(() => {
    const expenses = filteredTransactions.filter(t => t.type === 'expense');
    const map = {};
    expenses.forEach(t => {
      const catName = CATEGORIES.find(c => c.id === t.category)?.name || 'Outros';
      map[catName] = (map[catName] || 0) + t.amount;
    });
    
    return Object.entries(map).map(([name, value]) => {
      const cat = CATEGORIES.find(c => c.name === name) || CATEGORIES.find(c => c.id === 'outros');
      return { id: cat.id, name, value };
    }).filter(d => d.value > 0);
  }, [filteredTransactions]);

  function addTransaction(tx){ 
    setTransactions(prev => [tx, ...prev]);
    setShowForm(false);
    setEditingTransaction(null);
  }

  function updateTransaction(updatedTx){
    setTransactions(prev => prev.map(t => t.id === updatedTx.id ? updatedTx : t));
    setShowForm(false);
    setEditingTransaction(null);
  }

  function deleteTransaction(id){
    setTransactions(prev => prev.filter(t => t.id !== id));
  }

  function handleEditTransaction(tx){
    setEditingTransaction(tx);
    setShowForm(true);
  }

  function toggleTheme(){
    setDarkMode(prev => !prev);
  }

  return (
    <div className={`app-frame ${darkMode ? 'dark' : ''}`}>
      {/* SIDE MENU */}
      <SideMenu 
        isOpen={menuOpen} 
        onClose={() => setMenuOpen(false)}
        currentScreen={screen}
        setCurrentScreen={setScreen}
        darkMode={darkMode}
        toggleTheme={toggleTheme}
        profile={profile}
      />

      {/* MENU TOGGLE (MOBILE) */}
      {screen !== 'profile' && (
        <button 
          onClick={() => setMenuOpen(true)}
          className="fixed top-4 left-4 z-50 p-2 bg-white dark:bg-gray-800 rounded-full shadow-lg md:hidden"
        >
          <IconMenu />
        </button>
      )}

      {/* SCREENS */}
      {screen === 'profile' && (
        <ProfileScreen 
          onComplete={() => {
            setProfile(loadData(PROFILE_KEY));
            setScreen('dashboard');
          }} 
        />
      )}

      {screen === 'dashboard' && (
        <DashboardScreen 
          expensesByCategory={expensesByCategory}
          allTransactions={filteredTransactions}
          selectedMonth={selectedMonth}
          setSelectedMonth={setSelectedMonth}
          onAddClick={() => {
            setEditingTransaction(null);
            setShowForm(true);
          }}
          onDeleteTransaction={deleteTransaction}
          onEditTransaction={handleEditTransaction}
          darkMode={darkMode}
        />
      )}

      {screen === 'transactions' && (
        <TransactionsScreen 
          transactions={filteredTransactions}
          selectedMonth={selectedMonth}
          setSelectedMonth={setSelectedMonth}
          onDeleteTransaction={deleteTransaction}
          onEditTransaction={handleEditTransaction}
        />
      )}

      {screen === 'tips' && (
        <TipsScreen />
      )}

      {screen === 'settings' && (
        <SettingsScreen 
          darkMode={darkMode}
          toggleTheme={toggleTheme}
          profile={profile}
        />
      )}

      {/* TRANSACTION FORM MODAL */}
      {showForm && (
        <TransactionForm 
          editing={editingTransaction}
          initialType={editingTransaction?.type || 'expense'}
          onSave={(tx) => {
            if(editingTransaction){
              updateTransaction(tx);
            } else {
              addTransaction(tx);
            }
          }}
          onCancel={() => {
            setShowForm(false);
            setEditingTransaction(null);
          }}
        />
      )}

      {/* FOOTER */}
      {screen !== 'profile' && (
        <div className="app-footer dark:text-gray-400">
          ¬© 2025 √çtalo Rocha
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
