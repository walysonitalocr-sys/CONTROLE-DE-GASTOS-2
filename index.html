<!doctype html>
<html lang="pt-BR">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Meus Gastos Pro â€” Meus Gastos</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <script>tailwind.config = { darkMode: 'class' }</script>

Â  Â  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
Â  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

Â  Â  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

Â  <style>
Â  Â  /* Melhoria Visual: Cores e Sombra mais profissionais */
Â  Â  :root {
Â  Â  Â  --primary: #10B981; /* Verde esmeralda */
Â  Â  Â  --accent: #3B82F6; Â /* Azul vibrante */
Â  Â  Â  --muted: #64748b;
Â  Â  }

Â  Â  body { -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
Â  Â  /* Gradiente horizontal suave para botÃµes */
Â  Â  .accent-btn { 
Â  Â  Â  background-image: linear-gradient(to right, var(--primary), var(--accent)); 
Â  Â  Â  color: white; 
Â  Â  Â  transition: all 0.2s ease; 
Â  Â  }
Â  Â  .accent-btn:hover { opacity: 0.9; }

Â  Â  /* Card com borda e sombra mais sutis */
Â  Â  .card { 
Â  Â  Â  background: white; 
Â  Â  Â  border-radius: 16px; 
Â  Â  Â  box-shadow: 0 4px 12px rgba(15,23,42,0.04), 0 1px 2px rgba(15,23,42,0.02);
Â  Â  Â  border: 1px solid #e2e8f0; 
Â  Â  Â  transition: transform 0.18s ease;
Â  Â  }
Â  Â  .dark .card { 
Â  Â  Â  background: #1f2937;
Â  Â  Â  box-shadow: 0 6px 20px rgba(2,6,23,0.3); 
Â  Â  Â  border: 1px solid #374151;
Â  Â  }
Â  Â  .chip { transition: transform .12s ease, box-shadow .12s ease; }
Â  Â  .chip:active { transform: translateY(1px); }
Â  Â  
Â  Â  canvas { max-width: 100% !important; height: auto !important; }
Â  Â  .donut-center { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; }
Â  Â  @media (max-width: 768px) { .app-shell { padding: 16px; } }
Â  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

<div id="root"></div>

<script type="text/babel">
/* Single-file React app: Meus Gastos Pro (Design Aprimorado) */
/* Globals available: React, ReactDOM, Chart */

const { useState, useEffect, useMemo, useRef } = React;

/* ---------------- CONFIG ---------------- */
const APP_NAME = "Meus Gastos Pro";
const PROFILE_KEY = "meus_gastos_profile_v1";
const TX_KEY = "meus_gastos_transactions_v1";

/* ---------------- CATEGORIES + ICONS ---------------- */
/* Icons as React components (inline SVG) */
function IconFork() {
Â  return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M8 2v8" stroke="currentColor" strokeWidth="1.4" strokeLinecap="round"/><path d="M11 2v8" stroke="currentColor" strokeWidth="1.4" strokeLinecap="round"/><path d="M5 15v6" stroke="currentColor" strokeWidth="1.4" strokeLinecap="round"/><path d="M5 21h10" stroke="currentColor" strokeWidth="1.4" strokeLinecap="round"/></svg>);
}
function IconCar() {
Â  return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="7" width="18" height="8" rx="2" stroke="currentColor" strokeWidth="1.2"/><circle cx="7.5" cy="17.5" r="1.5" fill="currentColor"/><circle cx="16.5" cy="17.5" r="1.5" fill="currentColor"/></svg>);
}
function IconStar(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 17.3l-6.16 3.24 1.18-6.88L2 9.76l6.92-1.01L12 2l3.08 6.75L22 9.76l-5.02 3.9 1.18 6.88z" stroke="currentColor" strokeWidth="0.7"/></svg>); }
function IconHome(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 11.5L12 4l9 7.5" stroke="currentColor" strokeWidth="1.2"/><path d="M5 21V12h14v9" stroke="currentColor" strokeWidth="1.2"/></svg>); }
function IconCard(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" strokeWidth="1.2"/><path d="M2 10h20" stroke="currentColor" strokeWidth="1.2"/></svg>); }
function IconBook(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 19.5V6a2 2 0 0 1 2-2h11" stroke="currentColor" strokeWidth="1.2"/><path d="M20 7v12.5a.5.5 0 0 1-.65.48C18.44 19.6 16.6 19 14 19c-1.1 0-2 .1-3 .5V6" stroke="currentColor" strokeWidth="1.2"/></svg>); }
function IconWifi(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M2 8.5a15 15 0 0 1 20 0" stroke="currentColor" strokeWidth="1.2"/><path d="M6 12a9 9 0 0 1 12 0" stroke="currentColor" strokeWidth="1.2"/><path d="M10 16a3 3 0 0 1 4 0" stroke="currentColor" strokeWidth="1.2"/></svg>); }
function IconBolt(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z" stroke="currentColor" strokeWidth="1.1"/></svg>); }
function IconWater(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2s5 4.5 5 8.5A5 5 0 0 1 7 10.5C7 6.5 12 2 12 2z" stroke="currentColor" strokeWidth="1.1"/></svg>); }
function IconHeart(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 21s-7-4.35-9-7.04A5.56 5.56 0 0 1 7 6.04 5 5 0 0 1 12 9a5 5 0 0 1 5-2.96c2 0 5 2.96 4 7.92C19 16.65 12 21 12 21z" stroke="currentColor" strokeWidth="1.1"/></svg>); }
function IconDots(){ return (<svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="5" cy="12" r="1.5" fill="currentColor"/><circle cx="12" cy="12" r="1.5" fill="currentColor"/><circle cx="19" cy="12" r="1.5" fill="currentColor"/></svg>); }

const CATEGORIES = [
Â  { id: 'alimentacao', name: 'AlimentaÃ§Ã£o', color:'#10B981', Icon: IconFork },
Â  { id: 'transporte', name: 'Transporte', color:'#059669', Icon: IconCar },
Â  { id: 'lazer', name: 'Lazer', color:'#F59E0B', Icon: IconStar },
Â  { id: 'moradia', name: 'Moradia', color:'#3B82F6', Icon: IconHome },
Â  { id: 'cartoes', name: 'CartÃµes', color:'#7C3AED', Icon: IconCard },
Â  { id: 'faculdade', name: 'Faculdade', color:'#06B6D4', Icon: IconBook },
Â  { id: 'internet', name: 'Internet', color:'#60A5FA', Icon: IconWifi },
Â  { id: 'luz', name: 'Luz', color:'#F97316', Icon: IconBolt },
Â  { id: 'agua', name: 'Ãgua', color:'#06B6D4', Icon: IconWater },
Â  { id: 'saude', name: 'SaÃºde', color:'#84CC16', Icon: IconHeart },
Â  { id: 'outros', name: 'Outros', color:'#94A3B8', Icon: IconDots },
];

/* ---------------- helpers ---------------- */
function genId(){ return 'id-'+Date.now().toString(36)+'-'+Math.random().toString(36).slice(2,8); }
function monthKeyFromDate(dateStr){ return dateStr ? dateStr.slice(0,7) : new Date().toISOString().slice(0,7); }
function addOneMonthToDate(dateStr){
Â  const d = dateStr ? new Date(dateStr + 'T00:00:00') : new Date();
Â  const day = d.getDate(), m = d.getMonth(), y = d.getFullYear();
Â  let nm = m + 1, ny = y; if(nm > 11){ nm = 0; ny = y + 1; }
Â  const cand = new Date(ny, nm, day);
Â  if(cand.getMonth() !== nm){
Â  Â  const lastDay = new Date(ny, nm+1, 0).getDate();
Â  Â  return `${ny}-${String(nm+1).padStart(2,'0')}-${String(lastDay).padStart(2,'0')}`;
Â  }
Â  return `${ny}-${String(nm+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
}

/* ---------------- storage ---------------- */
function loadProfile(){ try{ const raw = localStorage.getItem(PROFILE_KEY); return raw ? JSON.parse(raw) : null; }catch{return null;} }
function saveProfile(p){ try{ localStorage.setItem(PROFILE_KEY, JSON.stringify(p)); }catch{} }
function loadTransactions(){
Â  try{
Â  Â  const raw = localStorage.getItem(TX_KEY);
Â  Â  if(!raw){
Â  Â  Â  // sample initial
Â  Â  Â  return [
Â  Â  Â  Â  { id:genId(), type:'income', category:'outros', amount:2500, date:'2025-10-01', description:'SalÃ¡rio', fixed:false },
Â  Â  Â  Â  { id:genId(), type:'expense', category:'moradia', amount:1200, date:'2025-10-01', description:'Aluguel', fixed:true },
Â  Â  Â  Â  { id:genId(), type:'expense', category:'luz', amount:120, date:'2025-10-05', description:'Conta de luz', fixed:true },
Â  Â  Â  Â  { id:genId(), type:'expense', category:'agua', amount:60, date:'2025-10-06', description:'Conta de Ã¡gua', fixed:true },
Â  Â  Â  Â  { id:genId(), type:'expense', category:'internet', amount:99.9, date:'2025-10-10', description:'Internet', fixed:true },
Â  Â  Â  Â  { id:genId(), type:'expense', category:'alimentacao', amount:45.5, date:'2025-10-25', description:'AlmoÃ§o', fixed:false },
Â  Â  Â  Â  { id:genId(), type:'expense', category:'transporte', amount:150, date:'2025-10-15', description:'CombustÃ­vel', fixed:false },
Â  Â  Â  ];
Â  Â  }
Â  Â  return JSON.parse(raw);
Â  }catch(e){ console.error(e); return []; }
}
function saveTransactions(data){ try{ localStorage.setItem(TX_KEY, JSON.stringify(data)); }catch(e){ console.error(e); } }

/* ---------------- ThemeToggle ---------------- */
function ThemeToggle(){
Â  const [dark, setDark] = useState(()=> localStorage.getItem('theme') === 'dark');
Â  useEffect(()=> {
Â  Â  const root = document.documentElement;
Â  Â  if(dark) root.classList.add('dark'); else root.classList.remove('dark');
Â  Â  localStorage.setItem('theme', dark ? 'dark' : 'light');
Â  }, [dark]);
Â  return (
Â  Â  <button onClick={()=> setDark(d => !d)} className="p-2 rounded-lg bg-white dark:bg-gray-800 border dark:border-gray-700 shadow-sm transition">
Â  Â  Â  {dark ? 'ğŸŒ™' : 'â˜€ï¸'}
Â  Â  </button>
Â  );
}

/* ---------------- Charts: donut with center text ---------------- */
function Donut({ items, total, colors, onSegmentClick }){
Â  const canvasRef = useRef(null);
Â  useEffect(()=>{
Â  Â  if(!canvasRef.current) return;
Â  Â  const labels = items.map(i => i.name);
Â  Â  const vals = items.map(i => i.value);
Â  Â  const bg = colors.length >= vals.length ? colors.slice(0, vals.length) : colors;
Â  Â  // plugin to draw center text
Â  Â  const centerPlugin = {
Â  Â  Â  id: 'centerText',
Â  Â  Â  beforeDraw(chart){
Â  Â  Â  Â  const { ctx, width, height } = chart;
Â  Â  Â  Â  ctx.save();
Â  Â  Â  Â  const value = total !== undefined ? `R$ ${Number(total).toFixed(2)}` : '';
Â  Â  Â  Â  ctx.font = `800 ${Math.round(Math.min(width, height)/12)}px sans-serif`;
Â  Â  Â  Â  ctx.fillStyle = document.documentElement.classList.contains('dark') ? '#E6EEF8' : '#0f1724';
Â  Â  Â  Â  ctx.textAlign = 'center';
Â  Â  Â  Â  ctx.textBaseline = 'middle';
Â  Â  Â  Â  ctx.fillText(value, width/2, height/2 - 6);
Â  Â  Â  Â  ctx.font = `400 ${Math.round(Math.min(width, height)/26)}px sans-serif`;
Â  Â  Â  Â  ctx.fillText('Total Gasto', width/2, height/2 + 20);
Â  Â  Â  Â  ctx.restore();
Â  Â  Â  }
Â  Â  };

Â  Â  const old = Chart.getChart(canvasRef.current);
Â  Â  if(old) old.destroy();
Â  Â  const ch = new Chart(canvasRef.current, {
Â  Â  Â  type: 'doughnut',
Â  Â  Â  data: { labels, datasets: [{ data: vals, backgroundColor: bg, borderColor: document.documentElement.classList.contains('dark') ? '#1f2937' : 'white', borderWidth: 3 }] },
Â  Â  Â  options: {
Â  Â  Â  Â  cutout: '68%',
Â  Â  Â  Â  plugins: { legend: { display: false } },
Â  Â  Â  Â  onClick(evt, elems){
Â  Â  Â  Â  Â  if(elems.length > 0){
Â  Â  Â  Â  Â  Â  const idx = elems[0].index;
Â  Â  Â  Â  Â  Â  onSegmentClick && onSegmentClick(labels[idx]);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  },
Â  Â  Â  Â  animation: { animateScale: true }
Â  Â  Â  },
Â  Â  Â  plugins: [centerPlugin]
Â  Â  });
Â  Â  return () => ch.destroy();
Â  }, [canvasRef, items, total, colors, onSegmentClick]);
Â  return (
Â  Â  <div className="relative">
Â  Â  Â  <canvas ref={canvasRef} className="w-full h-48" />
Â  Â  </div>
Â  );
}

/* ---------------- Bar chart ---------------- */
function FlowBar({ data }){
Â  const canvasRef = useRef(null);
Â  useEffect(()=>{
Â  Â  if(!canvasRef.current) return;
Â  Â  const labels = data.map(d => d.label);
Â  Â  const vals = data.map(d => d.value);
Â  Â  const old = Chart.getChart(canvasRef.current);
Â  Â  if(old) old.destroy();
Â  Â  const ch = new Chart(canvasRef.current, {
Â  Â  Â  type: 'bar',
Â  Â  Â  data: { labels, datasets: [{ label:'Fluxo (R$)', data: vals, backgroundColor: '#3B82F6', borderRadius: 4 }] },
Â  Â  Â  options: { 
Â  Â  Â  Â  plugins:{ legend:{ display:false } }, 
Â  Â  Â  Â  scales:{ 
Â  Â  Â  Â  Â  y:{ beginAtZero:true, grid: { color: document.documentElement.classList.contains('dark') ? '#374151' : '#f3f4f6' } },
Â  Â  Â  Â  Â  x: { grid: { display: false } }
Â  Â  Â  Â  } 
Â  Â  Â  }
Â  Â  });
Â  Â  return () => ch.destroy();
Â  }, [canvasRef, data]);
Â  return <canvas ref={canvasRef} className="w-full h-44" />;
}

/* ---------------- Components ---------------- */

function ProfileForm({ onSave }){
Â  const [name, setName] = useState('');
Â  const [dob, setDob] = useState('');
Â  function submit(e){ e.preventDefault(); if(!name) return alert('Digite seu nome'); onSave({ name, dob }); }
Â  return (
Â  Â  <form onSubmit={submit} className="space-y-4">
Â  Â  Â  <input value={name} onChange={e=>setName(e.target.value)} placeholder="Seu nome" className="w-full p-3 rounded-lg border dark:border-gray-700 dark:bg-gray-800 focus:ring-2 focus:ring-blue-500" />
Â  Â  Â  <input value={dob} onChange={e=>setDob(e.target.value)} type="date" className="w-full p-3 rounded-lg border dark:border-gray-700 dark:bg-gray-800 focus:ring-2 focus:ring-blue-500" />
Â  Â  Â  <button className="w-full py-3 rounded-lg accent-btn font-semibold shadow-lg shadow-blue-500/50">ComeÃ§ar</button>
Â  Â  </form>
Â  );
}

function TransactionForm({ onAdd, editing, onUpdate, onCancel }){
Â  const [form, setForm] = useState({ type:'expense', category:'alimentacao', amount:'', date:'', description:'', fixed:false });
Â  useEffect(()=> { if(editing) setForm(editing); else setForm({ type:'expense', category:'alimentacao', amount:'', date:'', description:'', fixed:false }); }, [editing]);

Â  function handle(e){
Â  Â  const { name, value, type, checked } = e.target;
Â  Â  setForm(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
Â  }
Â  function submit(e){
Â  Â  e.preventDefault();
Â  Â  if(!form.amount || isNaN(Number(form.amount))) return alert('Digite um valor vÃ¡lido');
Â  Â  const payload = { ...form, id: form.id || genId(), amount: Number(form.amount), date: form.date || new Date().toISOString().slice(0,10) };
Â  Â  editing ? onUpdate(payload) : onAdd(payload);
Â  Â  setForm({ type:'expense', category:'alimentacao', amount:'', date:'', description:'', fixed:false });
Â  }

Â  return (
Â  Â  <form onSubmit={submit} className="p-5 card">
Â  Â  Â  <h3 className="text-xl font-bold mb-4">{editing ? 'Editar TransaÃ§Ã£o' : 'Nova TransaÃ§Ã£o'}</h3>
Â  Â  Â  <div className="grid grid-cols-2 gap-3 mb-3">
Â  Â  Â  Â  <select name="type" value={form.type} onChange={handle} className="p-2 rounded-lg border dark:border-gray-700 dark:bg-gray-800 text-sm">
Â  Â  Â  Â  Â  <option value="expense">Despesa</option>
Â  Â  Â  Â  Â  <option value="income">Receita</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <select name="category" value={form.category} onChange={handle} className="p-2 rounded-lg border dark:border-gray-700 dark:bg-gray-800 text-sm">
Â  Â  Â  Â  Â  {CATEGORIES.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
Â  Â  Â  Â  </select>
Â  Â  Â  </div>

Â  Â  Â  <input name="amount" value={form.amount} onChange={handle} placeholder="Valor (ex: 45.50)" type="number" step="0.01" className="w-full p-2 rounded-lg mb-2 border dark:border-gray-700 dark:bg-gray-800" />
Â  Â  Â  <input name="date" type="date" value={form.date} onChange={handle} className="w-full p-2 rounded-lg mb-2 border dark:border-gray-700 dark:bg-gray-800" />
Â  Â  Â  <input name="description" value={form.description} onChange={handle} placeholder="DescriÃ§Ã£o (opcional)" className="w-full p-2 rounded-lg mb-3 border dark:border-gray-700 dark:bg-gray-800" />

Â  Â  Â  <label className="flex items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-300">
Â  Â  Â  Â  <input type="checkbox" name="fixed" checked={form.fixed} onChange={handle} className="rounded text-blue-600 focus:ring-blue-500" /> <span>Marcar como despesa fixa</span>
Â  Â  Â  </label>

Â  Â  Â  <div className="flex gap-2">
Â  Â  Â  Â  <button type="submit" className="flex-1 py-3 rounded-lg accent-btn font-semibold shadow-md">{editing ? 'Atualizar TransaÃ§Ã£o' : 'Adicionar TransaÃ§Ã£o'}</button>
Â  Â  Â  Â  {editing && <button type="button" onClick={onCancel} className="px-4 py-3 rounded-lg border dark:border-gray-700 dark:bg-gray-800 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition">Cancelar</button>}
Â  Â  Â  </div>
Â  Â  </form>
Â  );
}

function TransactionList({ transactions, onEdit, onDelete, onToggleFixed }){
Â  function catName(id){ return CATEGORIES.find(c=>c.id===id)?.name || id; }
Â  function catColor(id){ return CATEGORIES.find(c=>c.id===id)?.color || '#94A3B8'; }
Â  
Â  return (
Â  Â  <div className="p-5 card">
Â  Â  Â  <h3 className="text-xl font-bold mb-4 border-b pb-2 dark:border-gray-700">HistÃ³rico de TransaÃ§Ãµes</h3>
Â  Â  Â  <div className="space-y-3 max-h-96 overflow-y-auto pr-2">
Â  Â  Â  Â  {transactions.length === 0 && <div className="text-sm text-gray-500 text-center py-4">Nenhuma transaÃ§Ã£o registrada para o mÃªs selecionado.</div>}
Â  Â  Â  Â  {transactions.map(t => (
Â  Â  Â  Â  Â  <div key={t.id} className="flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-3">
Â  Â  Â  Â  Â  Â  Â  <div className="w-2 h-10 rounded-full" style={{backgroundColor: t.type === 'income' ? '#10B981' : catColor(t.category)}}></div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="text-base font-medium">{t.description || catName(t.category)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div className="text-xs text-gray-500 dark:text-gray-400 mt-0.5">{catName(t.category)} â€¢ {t.date}</div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-3">
Â  Â  Â  Â  Â  Â  Â  <div className={`${t.type === 'income' ? 'text-green-600 dark:text-green-400' : 'text-red-500 dark:text-red-400'} font-bold`}>R$ {Number(t.amount).toFixed(2)}</div>
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <label title="Despesa fixa" className="flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400 cursor-pointer">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" checked={!!t.fixed} onChange={()=> onToggleFixed(t.id)} className="rounded text-blue-600" />
Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  <button onClick={()=> onEdit(t)} className="text-sm text-blue-500 hover:text-blue-600 transition">Editar</button>
Â  Â  Â  Â  Â  Â  Â  <button onClick={()=> { if(confirm('Excluir essa transaÃ§Ã£o?')) onDelete(t.id) }} className="text-sm text-red-500 hover:text-red-600 transition">Excluir</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ))}
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}

function CategoryChips({ active, onSelect }){
Â  return (
Â  Â  <div className="flex flex-wrap gap-2">
Â  Â  Â  <button onClick={()=> onSelect(null)} className={`chip px-3 py-1 rounded-full text-sm font-medium transition ${active===null ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-200 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-700'}`}>Todos</button>
Â  Â  Â  {CATEGORIES.map(c => (
Â  Â  Â  Â  <button key={c.id} onClick={()=> onSelect(c.id)} className={`chip inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium transition ${active===c.id ? 'ring-2 ring-offset-1 ring-blue-500 dark:ring-offset-gray-900 bg-white dark:bg-gray-800' : 'bg-gray-200 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-700'}`}>
Â  Â  Â  Â  Â  <span className="w-6 h-6 rounded-full flex items-center justify-center" style={{background: c.color + '22'}}><c.Icon /></span>
Â  Â  Â  Â  Â  <span>{c.name}</span>
Â  Â  Â  Â  </button>
Â  Â  Â  ))}
Â  Â  </div>
Â  );
}

function ImportButton({ onImport }){
Â  const ref = useRef(null);
Â  function handleFile(e){
Â  Â  const f = e.target.files[0]; if(!f) return;
Â  Â  const reader = new FileReader();
Â  Â  reader.onload = () => onImport(reader.result);
Â  Â  reader.readAsText(f);
Â  Â  e.target.value = '';
Â  }
Â  return (
Â  Â  <>
Â  Â  Â  <input ref={ref} type="file" accept="application/json" className="hidden" onChange={handleFile} />
Â  Â  Â  <button onClick={()=> ref.current.click()} className="px-3 py-2 rounded-lg text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition shadow-sm">Importar</button>
Â  Â  </>
Â  );
}

/* ---------------- Main App ---------------- */

function App(){
Â  const [profile, setProfile] = useState(()=> loadProfile());
Â  const [transactions, setTransactions] = useState(()=> loadTransactions());
Â  const [editing, setEditing] = useState(null);
Â  const [selectedMonth, setSelectedMonth] = useState(()=> new Date().toISOString().slice(0,7));
Â  const [activeCategory, setActiveCategory] = useState(null);

Â  useEffect(()=> saveProfile(profile), [profile]);
Â  useEffect(()=> saveTransactions(transactions), [transactions]);

Â  // derived lists
Â  const transactionsForMonth = useMemo(()=> transactions.filter(t => monthKeyFromDate(t.date) === selectedMonth).sort((a,b)=> b.date.localeCompare(a.date)), [transactions, selectedMonth]);
Â  const totalForMonth = useMemo(()=> transactionsForMonth.reduce((s,t)=> t.type === 'income' ? s + t.amount : s - t.amount, 0), [transactionsForMonth]);

Â  const byCategoryForMonth = useMemo(()=> {
Â  Â  const map = {}; CATEGORIES.forEach(c => map[c.id] = 0);
Â  Â  transactionsForMonth.forEach(t => { if(t.type === 'expense') map[t.category] = (map[t.category] || 0) + t.amount; });
Â  Â  return CATEGORIES.map(c => ({ id:c.id, name:c.name, value: map[c.id] })).filter(d => d.value > 0 && (!activeCategory || activeCategory === d.id));
Â  }, [transactionsForMonth, activeCategory]);

Â  const barDataForMonth = useMemo(()=> {
Â  Â  const map = {};
Â  Â  transactionsForMonth.forEach(t => { const day = t.date.slice(8,10); map[day] = (map[day] || 0) + (t.type === 'expense' ? t.amount : -t.amount); });
Â  Â  return Object.entries(map).sort((a,b)=> a[0]-b[0]).map(([k,v])=> ({ label:k, value:v }));
Â  }, [transactionsForMonth]);

Â  const availableMonths = useMemo(()=> {
Â  Â  const s = new Set(transactions.map(t => monthKeyFromDate(t.date)));
Â  Â  s.add(new Date().toISOString().slice(0,7));
Â  Â  return Array.from(s).filter(Boolean).sort().reverse();
Â  }, [transactions]);

Â  // actions
Â  function addTransaction(tx){ setTransactions(prev => [tx, ...prev]); }
Â  function updateTransaction(updated){ setTransactions(prev => prev.map(p => p.id === updated.id ? updated : p)); setEditing(null); }
Â  function deleteTransaction(id){ setTransactions(prev => prev.filter(p => p.id !== id)); }
Â  function toggleFixed(id){ setTransactions(prev => prev.map(p => p.id === id ? { ...p, fixed: !p.fixed } : p)); }

Â  function copyFixedToNextMonth(){
Â  Â  const fixedThisMonth = transactionsForMonth.filter(t => t.fixed);
Â  Â  if(fixedThisMonth.length === 0) return alert('NÃ£o hÃ¡ despesas fixas no mÃªs selecionado.');
Â  Â  const [y,m] = selectedMonth.split('-').map(Number);
Â  Â  let nm = m+1, ny = y;
Â  Â  if(nm > 12){ nm = 1; ny += 1; }
Â  Â  const nextMonthKey = `${ny}-${String(nm).padStart(2,'0')}`;
Â  Â  const newItems = fixedThisMonth.map(t => ({ ...t, id: genId(), date: addOneMonthToDate(t.date) }));
Â  Â  // check duplicates
Â  Â  const duplicates = newItems.filter(ni => transactions.some(ex => monthKeyFromDate(ex.date) === nextMonthKey && ex.description === ni.description && ex.amount === ni.amount && ex.category === ni.category));
Â  Â  if(duplicates.length > 0){
Â  Â  Â  if(!confirm(`Existem ${duplicates.length} despesas iguais no prÃ³ximo mÃªs. Deseja adicionar mesmo assim?`)) {
Â  Â  Â  Â  const nonDup = newItems.filter(ni => !duplicates.some(d => d.description === ni.description && d.amount === ni.amount && d.category === ni.category));
Â  Â  Â  Â  if(nonDup.length > 0) setTransactions(prev => [...nonDup, ...prev]);
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  }
Â  Â  setTransactions(prev => [...newItems, ...prev]);
Â  Â  alert('Despesas fixas copiadas para o prÃ³ximo mÃªs.');
Â  }

Â  function exportJSON(){
Â  Â  const blob = new Blob([JSON.stringify(transactions, null, 2)], { type: 'application/json' });
Â  Â  const url = URL.createObjectURL(blob);
Â  Â  const a = document.createElement('a');
Â  Â  a.href = url; a.download = 'meus_gastos_backup.json'; a.click(); URL.revokeObjectURL(url);
Â  }

Â  function importJSONString(str){
Â  Â  try{
Â  Â  Â  const parsed = JSON.parse(str);
Â  Â  Â  if(!Array.isArray(parsed)) throw new Error('Formato invÃ¡lido');
Â  Â  Â  const fixed = parsed.map(p => ({ id: p.id || genId(), type: p.type, category: p.category || 'outros', amount: Number(p.amount) || 0, date: p.date || new Date().toISOString().slice(0,10), description: p.description || '', fixed: !!p.fixed }));
Â  Â  Â  setTransactions(prev => [...fixed, ...prev]);
Â  Â  Â  alert('Importado com sucesso.');
Â  Â  } catch(e) { alert('Erro ao importar: ' + e.message); }
Â  }

Â  function gotoPrevMonth(){ const [y,m] = selectedMonth.split('-').map(Number); let nm = m-1, ny = y; if(nm < 1){ nm=12; ny -= 1 } setSelectedMonth(`${ny}-${String(nm).padStart(2,'0')}`); }
Â  function gotoNextMonth(){ const [y,m] = selectedMonth.split('-').map(Number); let nm = m+1, ny = y; if(nm > 12){ nm=1; ny +=1 } setSelectedMonth(`${ny}-${String(nm).padStart(2,'0')}`); }

Â  if(!profile){
Â  Â  return (
Â  Â  Â  <div className="min-h-screen flex items-center justify-center app-shell p-6">
Â  Â  Â  Â  <div className="w-full max-w-md p-6 rounded-2xl bg-gradient-to-br from-indigo-500 to-blue-600 text-white shadow-xl">
Â  Â  Â  Â  Â  <h1 className="text-3xl font-bold mb-2">{APP_NAME}</h1>
Â  Â  Â  Â  Â  <p className="opacity-90 mb-4">Crie seu perfil rÃ¡pido para comeÃ§ar a controlar suas finanÃ§as.</p>
Â  Â  Â  Â  Â  <ProfileForm onSave={(p)=>{ setProfile(p); saveProfile(p); }} />
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  );
Â  }

Â  return (
Â  Â  <div className="min-h-screen p-0 app-shell">
Â  Â  Â  <div className="max-w-6xl mx-auto">
Â  Â  Â  Â  {/* HEADER MAIS ROBUSTO E PROFISSIONAL */}
Â  Â  Â  Â  <header className="sticky top-0 z-10 bg-inherit/95 backdrop-blur-sm px-6 py-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border-b dark:border-gray-800">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <h1 className="text-2xl font-extrabold flex items-center gap-3 text-transparent bg-clip-text bg-gradient-to-r from-green-500 to-blue-500">
Â  Â  Â  Â  Â  Â  Â  {APP_NAME}
Â  Â  Â  Â  Â  Â  </h1>
Â  Â  Â  Â  Â  Â  <div className="text-sm text-gray-500 dark:text-gray-400 mt-1">OlÃ¡, <strong className="font-semibold">{profile.name}</strong> ğŸ‘‹</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div className="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  {/* CONTROLE DE MÃŠS */}
Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-1 bg-white dark:bg-gray-800 p-1.5 rounded-lg border dark:border-gray-700 shadow-sm text-sm">
Â  Â  Â  Â  Â  Â  Â  <button onClick={gotoPrevMonth} className="p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition">
Â  Â  Â  Â  Â  Â  Â  Â  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  <input type="month" value={selectedMonth} onChange={e => setSelectedMonth(e.target.value)} className="bg-transparent text-sm font-medium w-28 text-center" />
Â  Â  Â  Â  Â  Â  Â  <button onClick={gotoNextMonth} className="p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition">
Â  Â  Â  Â  Â  Â  Â  Â  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  {/* BOTÃ•ES DE AÃ‡ÃƒO */}
Â  Â  Â  Â  Â  Â  <button onClick={copyFixedToNextMonth} className="px-3 py-2 rounded-lg text-sm bg-orange-500 hover:bg-orange-600 text-white transition shadow-md">Copiar fixas â†’</button>
Â  Â  Â  Â  Â  Â  <button onClick={exportJSON} className="px-3 py-2 rounded-lg text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition shadow-sm">Exportar</button>
Â  Â  Â  Â  Â  Â  <ImportButton onImport={(txt)=> importJSONString(txt)} />
Â  Â  Â  Â  Â  Â  <ThemeToggle />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  {/* CONTEÃšDO PRINCIPAL */}
Â  Â  Â  Â  <div className="p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  <aside className="lg:col-span-1">
Â  Â  Â  Â  Â  Â  <TransactionForm 
Â  Â  Â  Â  Â  Â  Â  onAdd={addTransaction} 
Â  Â  Â  Â  Â  Â  Â  editing={editing} 
Â  Â  Â  Â  Â  Â  Â  onUpdate={updateTransaction} 
Â  Â  Â  Â  Â  Â  Â  onCancel={()=> setEditing(null)} 
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  <div className="mt-4 flex gap-2">
Â  Â  Â  Â  Â  Â  Â  <button onClick={()=> { if(confirm('Limpar todas as transaÃ§Ãµes?')) setTransactions([]); }} className="flex-1 py-2 rounded-lg text-sm bg-red-500 hover:bg-red-600 text-white transition shadow-md">Limpar tudo</button>
Â  Â  Â  Â  Â  Â  Â  <button onClick={()=> { setTransactions(loadTransactions()); alert('Exemplo restaurado') }} className="flex-1 py-2 rounded-lg text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition">Restaurar Exemplo</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </aside>

Â  Â  Â  Â  Â  <main className="lg:col-span-2 space-y-6">
Â  Â  Â  Â  Â  Â  {/* CARD DE RESUMO MAIS ELEGANTE */}
Â  Â  Â  Â  Â  Â  <div className="p-6 rounded-2xl card">
Â  Â  Â  Â  Â  Â  Â  <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  <div className="mb-4 sm:mb-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="text-sm font-medium text-gray-500 dark:text-gray-400">Saldo Atual (MÃªs)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className={`text-4xl font-extrabold ${totalForMonth >= 0 ? 'text-green-500' : 'text-red-500'} mt-1`}>R$ {totalForMonth.toFixed(2)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="text-xs text-gray-500 mt-1">{transactionsForMonth.length} transaÃ§Ãµes registradas</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div className="w-full sm:w-64 p-4 rounded-lg bg-gray-50 dark:bg-gray-800 shadow-inner">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="text-sm font-medium mb-2 border-b pb-1 dark:border-gray-700">Resumo RÃ¡pido</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="mt-1 text-sm space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between text-green-500"><span>Receitas:</span> <span className="font-semibold">R$ {transactionsForMonth.filter(t=>t.type==='income').reduce((s,t)=> s + t.amount, 0).toFixed(2)}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between text-red-500"><span>Despesas:</span> <span className="font-semibold">R$ {transactionsForMonth.filter(t=>t.type==='expense').reduce((s,t)=> s + t.amount, 0).toFixed(2)}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  {/* GRÃFICO DE DONUT E CHIPS */}
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center justify-between mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="text-lg font-semibold">Despesas por Categoria</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="text-xs text-gray-500 dark:text-gray-400">Clique para filtrar</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <CategoryChips active={activeCategory} onSelect={(c) => setActiveCategory(c)} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Donut items={byCategoryForMonth} total={ byCategoryForMonth.reduce((s,d)=> s + d.value, 0) } colors={ byCategoryForMonth.map((d,i)=> ['#10B981','#059669','#06B6D4','#3B82F6','#60A5FA','#7DD3FC','#0EA5A9','#34D399','#FBBF24'][i % 9]) } onSegmentClick={(label)=> {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const found = CATEGORIES.find(c => c.name === label);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(found) setActiveCategory(found.id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  {/* GRÃFICO DE BARRAS */}
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="text-lg font-semibold mb-3">Fluxo de Caixa DiÃ¡rio (LÃ­quido)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="p-4 card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <FlowBar data={barDataForMonth} />
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  {/* LISTA DE TRANSAÃ‡Ã•ES */}
Â  Â  Â  Â  Â  Â  <TransactionList transactions={transactionsForMonth} onEdit={(t)=> setEditing(t)} onDelete={deleteTransaction} onToggleFixed={toggleFixed} />
Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <footer className="mt-8 mb-4 text-center text-sm text-gray-500">Â© 2025 Italo Rocha | Design Aprimorado</footer>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
